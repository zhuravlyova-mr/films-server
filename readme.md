# Веб-сервер для БД фильмов


![Локальный http-сервер](images/http.jpg)
![Локальный http-сервер](images/http_gf.jpg)


Это небольшой веб-сервер на nodeJS. 

Он работает с базой данных фильмов, в которой есть таблицы:


### Таблица жанров - genres


1. id: первичный ключ 
2. name: название жанра (с ограничением уникальности)


### Таблица фильмов - film


![](images/demo.jpg)
![](images/clipper.jpg)

1. id: первичный ключ
2. name: название фильма (с ограничением уникальности)
3. year: год выпуска фильма


### Таблица-связка фильмов с жанрами - film_genres


1. film_id: id фильма, внешний ключ, ссылка на id в film
2. genres_id: id жанра, внешний ключ, ссылка на id в genres


Фреймворк для работы сервера содержится в каталоге framework и реализован на nodeJS в соответствии с описанием из видео: (https://www.youtube.com/watch?v=243pQXC5Ebs).

CRUD-операции для взаимодействия с жанрами и фильмами представлены в файлах каталога src. Подробности их реализации и особенности использования представлены ниже.


## Порядок использования сервера


База данных называется films. Для создания базы данных и заполнения некоторыми начальными данными ее таблиц, рекомендуется выполнить следующие действия:

1. Закрыть все подключения к films. Переключиться на какую-либо другую базу данных, например, postgres, т.е. в в psql выполнить:

\c postgres


Далее в psql нужно выполнить скрипт script_small.sql, находящийся в корне репозитория (скрипт удаляет текущую базу данных films, поэтому при необходимости следует сделать ее бэкап):

\i /путь_к_скрипту/script_small.sql

Сервер создается на локальном компьютере, открывает для подключения и "слушает" заданный порт. 

Используются следующие адреса (endpoints) для отправки запросов:  '/films' - для CRUD-операций с фильмами и '/genres' - для CRUD-операций с жанрами.
Т.е. при тестировании можно выбирать один из запросов POST/GET/PUT/DELETE для адресов localhost:5000/films или localhost:5000/genres.

В запросах GET в строке адреса можно вводить параметры после ?, разделенные с помощью &.  При этом знак = после ключа (с модификаторами вида <, >, like) обязателен.

При указании знака > или < между ним и знаком равенства не должно быть пробелов.

Например, при реализации GET к фильмам для id и year можно писать: /films?id=3&year>=1999 или films?id>=2&year=2010, или films?id=2&year<=2010: реализуются операции >=, <=, =. 



Для name можно писать: name=The Shack или name like=%The Shack%, будет реализован соответствующий запрос на равенство, или поиск фильма, в названии которого содержится указанная строка (знаки % нужно обязательно указывать).
То же относится к жанрам - можно задавать аналогичные условия для id и name.



В каталоге examples находятся файлы с примерами тестов для разных операций CRUD, указаны примеры запросов и ответов.
